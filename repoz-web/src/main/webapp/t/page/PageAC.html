<section class="windfury">

	<section class="main">
		<div class="acMain">
			<h1>Repositories Access Control</h1>
			<table>
				<thead>
					<tr>
						<th>Repository</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody></tbody>
			</table>
			<div class="buttons">
				<button class="add">Add</button>
			</div>
		</div>
	</section>

	<script type="text/javascript">
		windfury.req([ 't/templ/base.html' ], function($, wf, base) {
			var main = wf.text('.main');

			function open() {
				var page = $(main());
				base.open(page);

				function doDelete(repo) {
					return function() {
						var msg = window.prompt('Type delete to confirm ' + repo + ' delete');
						if (!msg || msg.toLowerCase() != 'delete') {
							return false;
						}
						$.repoz.deleteRepository(repo, function() {
							open();
						});
						return false;
					}
				}

				function showRepos(repos) {
					var row = '<tr><td class="repo"/><td><a href="#" class="users">Users</a><button class="remove">Remove</button></td></tr>';
					for (var i = 0; $.oplt(i, repos.length); i++) {
						var repo = repos[i];
						var r = $(row);
						page.find('table tbody').append(r);
						r.find('.repo').text(repo);
						r.find('.users').attr('href', '#ACUsers?repo	=' + repo);
						r.find('.remove').click(doDelete(repo));
					}
				}

				function addNew() {
					var msg = window.prompt('Enter with repository name');
					if (msg) {
						msg = $.trim(msg);
					}
					if (!msg) {
						return false;
					}
					location = '#ACUsers?repo=' + msg;
				}

				page.find('.add').click(addNew);
				$.repoz.listRepositories(showRepos);
			}

			wf.def({
				open : open
			});
		});
	</script>

</section>